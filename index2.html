<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Hệ thống lấy số thứ tự - Demo</title>
  <style>
    :root{font-family:Inter, Roboto, Arial, sans-serif;color:#111}
    body{display:flex;align-items:center;justify-content:center;min-height:100vh;background:#f6f9fb;margin:0}
    .wrap{width:980px;background:white;border-radius:12px;box-shadow:0 6px 30px rgba(16,24,40,.08);padding:28px}
    .grid{display:grid;grid-template-columns:1fr 320px;gap:20px}
    h1{margin:0 0 12px;font-size:20px}
    .card{background:#fff;padding:18px;border-radius:10px;box-shadow:0 2px 8px rgba(16,24,40,.04)}
    button{padding:10px 14px;border-radius:8px;border:0;background:#2563eb;color:white;font-weight:600;cursor:pointer}
    .muted{color:#6b7280;font-size:13px}
    .ticket{font-size:48px;font-weight:800;margin:8px 0}
    .small{font-size:13px}
    .center{text-align:center}
    .col{display:flex;flex-direction:column;gap:8px}
    input[type=password]{padding:10px;border:1px solid #e5e7eb;border-radius:8px}
    .controls{display:flex;gap:8px}
    .print-ticket{border:1px dashed #e5e7eb;padding:12px;border-radius:8px}
    footer{margin-top:12px;color:#6b7280;font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="grid">
      <div>
        <h1>Máy lấy số - Khách hàng</h1>
        <div class="card">
          <div class="center">
            <div class="muted">Số hiện tại đang phục vụ</div>
            <div id="currentDisplay" class="ticket">---</div>
            <div class="muted small">Thời gian gọi: <span id="calledTime">-</span></div>
          </div>
        </div>

        <div style="height:12px"></div>

        <div class="card">
          <div class="center">
            <div class="muted">Lấy số thứ tự mới</div>
            <div style="height:10px"></div>
            <button id="takeBtn">Lấy số</button>
            <div style="height:12px"></div>
            <div class="print-ticket" id="ticketBox" style="display:none">
              <div class="muted small">Mã số của bạn</div>
              <div id="myTicket" class="ticket">A-001</div>
              <div class="muted small">Vui lòng chờ gọi tới lượt.</div>
              <div style="height:8px"></div>
              <button id="printBtn">In/Ghi lại</button>
            </div>
          </div>
        </div>

      </div>

      <div>
        <h1>Quản trị - Bàn phục vụ</h1>
        <div class="card col">
          <div class="muted">Đăng nhập (mã đơn giản để demo)</div>
          <input id="adminPin" type="password" placeholder="Nhập mã (mặc định: 1234)" />
          <div class="controls">
            <button id="loginBtn">Đăng nhập</button>
            <button id="logoutBtn" style="display:none;background:#ef4444">Đăng xuất</button>
          </div>

          <div id="adminArea" style="display:none">
            <div style="height:8px"></div>
            <div class="muted">Số đang chờ</div>
            <div id="waitingCount" class="ticket">0</div>
            <div class="controls">
              <button id="nextBtn">Gọi số tiếp theo</button>
              <button id="recallBtn" style="background:#f59e0b">Gọi lại</button>
            </div>
            <div style="height:8px"></div>
            <div class="muted small">Tùy chọn</div>
            <div class="controls">
              <button id="resetBtn" style="background:#6b7280">Reset hệ thống</button>
            </div>
            <div style="height:8px"></div>
            <div class="muted small">Mã API (demo): <code id="apiKey">local-demo</code></div>
          </div>
        </div>

        <footer>
          <div class="muted small">Lưu ý: file này là demo hoạt động hoàn toàn cục bộ (localStorage). Để dùng nhiều thiết bị, cần 1 backend (ví dụ Firebase / serverless).</div>
        </footer>
      </div>
    </div>
  </div>

  <script>
    // Simple queue logic stored in localStorage so it runs without server.
    // keys: queue_next, queue_current, queue_calledTime
    const DEFAULT_PIN = '1234';
    function get(key, def){return JSON.parse(localStorage.getItem(key) || JSON.stringify(def))}
    function set(key,val){localStorage.setItem(key, JSON.stringify(val))}

    if (!get('queue_next',null)) {
      set('queue_next', 1);
      set('queue_current', null);
      set('queue_waiting', []);
    }

    const els = {
      currentDisplay: document.getElementById('currentDisplay'),
      calledTime: document.getElementById('calledTime'),
      takeBtn: document.getElementById('takeBtn'),
      ticketBox: document.getElementById('ticketBox'),
      myTicket: document.getElementById('myTicket'),
      printBtn: document.getElementById('printBtn'),
      adminPin: document.getElementById('adminPin'),
      loginBtn: document.getElementById('loginBtn'),
      logoutBtn: document.getElementById('logoutBtn'),
      adminArea: document.getElementById('adminArea'),
      waitingCount: document.getElementById('waitingCount'),
      nextBtn: document.getElementById('nextBtn'),
      recallBtn: document.getElementById('recallBtn'),
      resetBtn: document.getElementById('resetBtn'),
    }

    function render(){
      const current = get('queue_current',null);
      els.currentDisplay.textContent = current ? formatTicket(current) : '---';
      els.calledTime.textContent = get('queue_calledTime','-');
      els.waitingCount.textContent = get('queue_waiting',[]).length;
    }

    function formatTicket(n){
      // e.g. A-001
      return 'A-' + String(n).padStart(3,'0');
    }

    els.takeBtn.addEventListener('click', ()=>{
      const next = get('queue_next',1);
      const waiting = get('queue_waiting',[]);
      waiting.push(next);
      set('queue_waiting', waiting);
      set('queue_next', next + 1);
      els.ticketBox.style.display = 'block';
      els.myTicket.textContent = formatTicket(next);
      // save last taken for print
      set('last_taken', next);
      render();
    });

    els.printBtn.addEventListener('click', ()=>{
      window.print();
    });

    els.loginBtn.addEventListener('click', ()=>{
      if (els.adminPin.value === DEFAULT_PIN) {
        els.adminArea.style.display = 'block';
        els.logoutBtn.style.display = 'inline-block';
        els.loginBtn.style.display = 'none';
        els.adminPin.style.display = 'none';
      } else {
        alert('Mã sai. Mã demo: 1234');
      }
    });

    els.logoutBtn.addEventListener('click', ()=>{
      els.adminArea.style.display = 'none';
      els.logoutBtn.style.display = 'none';
      els.loginBtn.style.display = 'inline-block';
      els.adminPin.style.display = 'inline-block';
      els.adminPin.value = '';
    });

    els.nextBtn.addEventListener('click', ()=>{
      const waiting = get('queue_waiting',[]);
      if (waiting.length === 0) { alert('Không còn khách chờ'); return; }
      const next = waiting.shift();
      set('queue_waiting', waiting);
      set('queue_current', next);
      set('queue_calledTime', new Date().toLocaleString());
      render();
      // Optional: play beep sound
      try{ new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=').play() }catch(e){}
    });

    els.recallBtn.addEventListener('click', ()=>{
      const current = get('queue_current', null);
      if (!current) { alert('Chưa có số nào được gọi'); return; }
      set('queue_calledTime', new Date().toLocaleString());
      render();
    });

    els.resetBtn.addEventListener('click', ()=>{
      if (!confirm('Reset toàn bộ dữ liệu local (chỉ cho demo)?')) return;
      localStorage.clear();
      location.reload();
    });

    // initial render
    render();

    // Optional: auto-refresh every 5s to reflect changes when multiple kiosk windows open on same browser profile
    setInterval(render, 5000);
  </script>
</body>
</html>
